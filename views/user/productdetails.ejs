<%- include('../partials/header') %>
<!-- breadcrumb -->
<div class="container">
    <!-- Your breadcrumb code remains unchanged -->
</div>

<!-- Product Detail -->
<section class="sec-product-detail bg0 p-t-65 p-b-60">
    <div class="container productdetails">
        <div class="row">
            <div class="col-md-6 col-lg-7 p-b-30">
                <div class="p-l-25 p-r-30 p-lr-0-lg">
                    <div class="wrap-slick3 flex-sb flex-w">
                        <div class="wrap-slick3-dots"></div>
                        <div class="wrap-slick3-arrows flex-sb-m flex-w"></div>
                        <div class="slick3 gallery-lb">
                            <!-- Iterate through each image in the product.images array -->
                            <% product.images.forEach((image, index) => { %>
                                <div class="item-slick3" data-thumb="<%= image %>">
                                    <div class="wrap-pic-w pos-relative">
                                        <img src="<%= image %>" alt="IMG-PRODUCT">

                                        <a class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04" href="<%= image %>">
                                            <i class="fa fa-expand"></i>
                                        </a>
                                    </div>
                                </div>
                            <% }) %>
                        
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 col-lg-5 p-b-30">
                <div class="p-r-50 p-t-5 p-lr-0-lg">
                    <h4 class="mtext-105 cl2 js-name-detail p-b-14">
                        <%= product.name %>
                    </h4>

                    <span class="mtext-106 cl2">
                        Rs.<%= product.price %>
                    </span>

                    <p class="stext-102 cl3 p-t-23">
                        <%= product.description %>
                    </p>

                    <form id="addToCartForm" action="/user/addToCart/<%= product._id %>" method="POST">
                        <!-- Hidden input for product ID -->
                        <input type="hidden" name="productId" value="<%= product._id %>">
                        <!-- Hidden input for quantity -->
                        <input type="hidden" name="quantity" id="quantityInput" value="1">
                    
                        <div class="flex-w flex-r-m p-b-10 mt-5">
                            <div class="size-204 flex-w flex-m respon6-next">
                                <!-- Wishlist button -->
                                <a href='javascript:void(0);' onclick="toggleWishlist(this)">
                                    <i class="zmdi zmdi-favorite-outline heart-icon js-addwish-b2" id="wishlistIcon" style="font-size: 24px;"></i>
                                </a>
                    
                                <div class="p-t-33">
                                    <div class="flex-w flex-r-m p-b-10">
                                        <div class="size-203 flex-c-m respon6">
                                            Size
                                        </div>
        
                                        <div class="size-204 respon6-next">
                                            <div class="rs1-select2 bor8 bg0">
                                                <select class="js-select2" name="time">
                                                    <option>Choose an option</option>
                                                    <option>Size S</option>
                                                    <option>Size M</option>
                                                    <option>Size L</option>
                                                    <option>Size XL</option>
                                                </select>
                                                <div class="dropDownSelect2"></div>
                                            </div>
                                        </div>
                                    </div>
        
                                    <div class="flex-w flex-r-m p-b-10">
                                        <div class="size-203 flex-c-m respon6">
                                            Color
                                        </div>
        
                                        <div class="size-204 respon6-next">
                                            <div class="rs1-select2 bor8 bg0">
                                                <select class="js-select2" name="time">
                                                    <option>Choose an option</option>
                                                    <option>Red</option>
                                                    <option>Blue</option>
                                                    <option>White</option>
                                                    <option>Grey</option>
                                                </select>
                                                <div class="dropDownSelect2"></div>
                                            </div>
                                        </div>
                                    </div>
                                <button type="submit" id="addToCartBtn" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-add-to-cart" onclick="toggleButtons()">
                                    Add to Cart
                                </button>
                               
                                
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

       
    </div>
</section>
                  
<<script>
    function toggleWishlist(wishlistButton) {
        const wishlistIcon = wishlistButton.querySelector('i#wishlistIcon');

        // Determine the current state of the wishlist (added or not)
        const isAdded = wishlistIcon.classList.contains('zmdi-favorite');

        // Toggle the heart icon color
        wishlistIcon.classList.toggle('zmdi-favorite-outline');
        wishlistIcon.classList.toggle('zmdi-favorite');

        // Send an AJAX request to the server to update the wishlist status
        const productId = '<%= product._id %>';
        updateWishlistStatus(productId, !isAdded);
    }

    async function updateWishlistStatus(productId, addToWishlist) {
        try {
            // Use async/await to handle the asynchronous fetch
            const response = await fetch(`/user/wishlist/${productId}`, {
                method: addToWishlist ? 'POST' : 'DELETE',
                // Additional headers and body if needed
            });

            if (response.ok) {
                console.log(`Wishlist ${addToWishlist ? 'added to' : 'removed from'} successfully`);
            } else {
                // Log the error status and response text
                console.error(`Failed to update wishlist status. Status: ${response.status}, ${await response.text()}`);
            }
        } catch (error) {
            // Log any network-related errors
            console.error('Network error:', error);
        }
    }
</script>

<%- include('../partials/footer') %>
