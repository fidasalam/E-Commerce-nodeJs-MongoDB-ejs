<%- include('../partials/header') %>
<!-- breadcrumb -->
<div class="container">
    <!-- Your breadcrumb code remains unchanged -->
</div>

<!-- Product Detail -->
<section class="sec-product-detail bg0 p-t-65 p-b-60">
    <div class="container productdetails">
        <div class="row">
            <div class="col-md-6 col-lg-7 p-b-30">
                <div class="p-l-25 p-r-30 p-lr-0-lg">
                    <div class="wrap-slick3 flex-sb flex-w">
                        <div class="wrap-slick3-dots"></div>
                        <div class="wrap-slick3-arrows flex-sb-m flex-w"></div>
                        <div class="slick3 gallery-lb">
                            <!-- Iterate through each image in the product.images array -->
                            <% product.images.forEach((image, index) => { %>
                                <div class="item-slick3" data-thumb="<%= image %>">
                                    <div class="wrap-pic-w pos-relative">
                                        <img src="<%= image %>" alt="IMG-PRODUCT">

                                        <a class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04" href="<%= image %>">
                                            <i class="fa fa-expand"></i>
                                        </a>
                                    </div>
                                </div>
                            <% }) %>
                        
                        </div>
                    </div>
                </div>
            </div>
<!-- Popup Message -->
<div id="wishlistPopupMessage" class="popup-message"></div>

            <div class="col-md-6 col-lg-5 p-b-30">
                <div class="p-r-50 p-t-5 p-lr-0-lg">
                    <h4 class="mtext-105 cl2 js-name-detail p-b-14">
                        <%= product.name %>
                    </h4>

                    <span class="mtext-106 cl2">
                        â‚¹<%= product.price %>
                    </span>

                    <p class="stext-102 cl3 p-t-23">
                        <%= product.description %>
                    </p>
                  
        

          <!-- Product Detail -->
<section class="sec-product-detail bg0 ">
    <div class="container productdetails">
        <!-- ... (other code remains unchanged) ... -->
        <form id="addToCartForm" action="/user/addToCart/<%= product._id %>" method="POST">
            <!-- Hidden input for product ID -->
            <input type="hidden" name="productId" value="<%= product._id %>">
            <!-- Hidden input for quantity -->
            <input type="hidden" name="quantity" id="quantityInput" value="1">
            <a href='javascript:void(0);' onclick="toggleWishlist(this)">
                <i class="zmdi zmdi-favorite-outline heart-icon js-addwish-b2 mt-5" id="wishlistIcon" style="font-size: 24px;"></i>
            </a>
            <div class="flex-w flex-r-m p-b-10 mt-5">
                <div class="size-204 flex-w flex-m respon6-next">
                    <!-- Wishlist button -->
                    

                        <button type="submit" id="addToCartBtn" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-add-to-cart mt-3" onclick="toggleButtons()">
                            Add to Cart
                        </button>
            
                        <% if (messages.error) { %>
                            <div class="flash error">
                              <%= messages.error %>
                            </div>
                          <% } %>
                          
                          <% if (messages.success) { %>
                            <div class="flash success">
                              <%= messages.success %>
                            </div>
                          <% } %>
                          
                </div>
                
            </div>
        </form>
        <!-- ... (other code remains unchanged) ... -->
    </div>
</section>

                </div>
            </div>
        </div>

       
    </div>
</section>
     
<script>

    
const urlParams = new URLSearchParams(window.location.search);
    const addedToCart = urlParams.get('addedToCart');

    // Show popup if 'addedToCart' is true
    if (addedToCart === 'true') {
        showPopupMessage('Product added to cart successfully');
    }
             
  function showPopupMessage(message) {
    const wishlistPopupMessage = document.getElementById('wishlistPopupMessage');

    // Set the message content
    wishlistPopupMessage.textContent = message;

    // Display the popup
    wishlistPopupMessage.style.display = 'block';

    // Clear the message after a delay (e.g., 3 seconds)
    setTimeout(() => {
        wishlistPopupMessage.style.display = 'none';
        wishlistPopupMessage.textContent = '';
    }, 3000); // 3000 milliseconds = 3 seconds
}

async function updateWishlistStatus(productId, addToWishlist) {
    try {
        const response = await fetch(`/user/wishlist/${productId}`, {
            method: addToWishlist ? 'POST' : 'DELETE',
            // Additional headers and body if needed
        });

        if (response.ok) {
            const message = `Product ${addToWishlist ? 'added to' : 'removed from'} wishlist successfully`;
            showPopupMessage(message);
        } else {
            console.error(`Failed to update wishlist status. Status: ${response.status}, ${await response.text()}`);
        }
    } catch (error) {
        console.error('Network error:', error);
    }
}

function toggleWishlist(wishlistButton) {
    const wishlistIcon = wishlistButton.querySelector('i#wishlistIcon');

    // Determine the current state of the wishlist (added or not)
    const isAdded = wishlistIcon.classList.contains('zmdi-favorite');

    // Toggle the heart icon color
    wishlistIcon.classList.toggle('zmdi-favorite-outline');
    wishlistIcon.classList.toggle('zmdi-favorite');

    // Send an AJAX request to the server to update the wishlist status
    const productId = '<%= product._id %>';
    updateWishlistStatus(productId, !isAdded);


}

    
</script>
<style>
    .popup-message {
    position: fixed;
    top: 10px;
    right: 10px;
    background-color: #4c54af; /* Green background */
    color: white; /* White text */
    padding: 15px; /* Some padding */
    border-radius: 5px; /* Rounded corners */
    display: none; /* Initially hidden */
}

</style>

<%- include('../partials/footer') %>
