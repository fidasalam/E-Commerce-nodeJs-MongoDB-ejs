<%- include('../partials/header') %>

<div class="container mt-5">
    <section class="bg0 p-t-23 p-b-140">
        <div class="container">
            <div class="p-b-10 text-center">
                <h3 class="ltext-103 cl5">
                    Wishlist
                </h3>
            </div>
            <!-- Wishlist Table -->
            <div class="container">
                <div class="bg0 p-t-75 p-b-85">
                    <div class="row">
                        <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
                            <div class="m-l-25 m-r--38 m-lr-0-xl">
                                <div class="wrap-table">
                                    <table class="table-shopping-cart">
                                        <thead>
                                            <tr class="table_head">
                                                <th class="column-1"></th>
                                                <th class="column-2"></th>
                                                <th class="column-3"></th>
                                                <th class="column-4"></th>
                                                <th class="column-5"></th>
                                                <th class="column-6"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Check if wishlist and wishlist.items exist before looping -->
                                            <% if (wishlist && wishlist.length > 0) { %>
                                                <!-- Loop through your wishlist items here -->
                                                <% wishlist.forEach(item => { %>
                                                    <tr class="table_row">
                                                        <td class="column-1">
                                                            <div class="how-itemcart1">
                                                                <img src="<%= item.product.images && item.product.images.length > 0 ? item.product.images[0] : '/path/to/placeholder-image.jpg' %>" alt="Product Image">
                                                            </div>
                                                        </td>

                                                        <td class="column-2">
                                                            <%= item.product ? item.product.name : '' %>
                                                        </td>
                                                        <td class="column-3">
                                                            <%= item.product ? ('$ ' + (item.product.price || 0).toFixed(2)) : '' %>
                                                        </td>

                                                        <!-- <td class="column-4">
                                                            <select id="size_<%= item.product._id %>" name="size" class="flex-c-m stext-101 cl0 bg2 bor1 hov-btn1 p-lr-15 trans-04 custom-select ml-3">
                                                                <option value="S">S</option>
                                                                <option value="M">M</option>
                                                                <option value="L">L</option>
                                                                <option value="XL">XL</option>
                                                            </select>
                                                        </td> -->
                                                        <td class="column-5">
                                                            <!-- Add a form to add item to cart -->
                                                            <form id="<%= `addToCartForm_${item.product._id}` %>" action="/user/wishlist/add-to-cart/<%= item.product._id %>" method="post">
                                                                <input type="hidden" name="productId" value="<%= item.product._id %>">
                                                                <button type="submit" class="btn">
                                                                    <i class="zmdi zmdi-shopping-cart"></i> Add to Cart
                                                                </button>
                                                            </form>
                                                        </td>
                                                        <td class="column-6">
                                                            <button type="button" class="btn" onclick="removeFromWishlist('<%= item.product._id %>')">
                                                                <i class="zmdi zmdi-close"></i> Remove from Wishlist
                                                            </button>
                                                        </td>
                                                    </tr>
                                                <% }); /* End of wishlist items loop */ %>
                                            <% } else { %>
                                                <!-- Display a message if wishlist is empty -->
                                                <tr>
                                                    <td colspan="5">Your wishlist is empty.</td>
                                                </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    function removeFromWishlist(productId) {
        // Send an AJAX request to remove the product from the wishlist
        $.ajax({
            type: 'DELETE',
            url: `/user/wishlist/${productId}`,
            success: function (data) {
                console.log('Successfully removed from wishlist');
                location.reload();  // Optionally, you can update the UI here to reflect the changes
            },
            error: function (error) {
                console.error('Error removing from wishlist:', error);
            }
        });
    }
    function addToCart(productId) {
        var form = document.getElementById(`addToCartForm_${productId}`);
        var formData = new FormData(form);

        fetch(form.action, {
            method: form.method,
            headers: {
                'Accept': 'application/json',
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response, you can update the UI as needed
            console.log(data);
        })
        .catch(error => {
            console.error('Error adding to cart:', error);
        });
    }
</script>

<%- include('../partials/footer') %>
